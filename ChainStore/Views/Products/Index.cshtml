@model IReadOnlyCollection<Product>
@inject ProductsGroupsViewMaker ProductsGroupsViewMaker
@inject SignInManager<ApplicationUser> SignInManager

@{
    ViewBag.Title = "Products";
}

<form asp-controller="Products" asp-action="Index">
    <div class="d-flex justify-content-center m-2">
        <p class="card-text mr-2">Product Name: </p>
        <input class="form-control col-2 mr-2" type="text" name="searchString" placeholder="name...">
        <input class="btn btn-primary ml-2" type="submit" value="Search"/>
    </div>
</form>
<div class="m-3">
    <div class="row justify-content-start m-3">
        @{ var productsGroups = ProductsGroupsViewMaker.MakeProductsGroups(Model); }
        @if (productsGroups.Count != 0)
        {
            foreach (var groupOfProducts in productsGroups.Where(groupOfProducts => groupOfProducts.Count() != 0))
            {
                <div class="col-lg-4 col-md-6 col-sm-12 mt-3">
                    <div class="card text-center">
                        <h5 class="card-header">@groupOfProducts.Key</h5>
                        <h6 class="card-title mb-2 mt-2 text-muted">Left: @groupOfProducts.Count()</h6>
                        <div class="card-body">
                            <p class="card-text mt-3">
                                Price: @groupOfProducts.First().Price UAH
                            </p>
                        </div>
                        <div class="card-footer text-center">
                            <div class="row col-12 col-sm-auto col-md-12">
                                @if (SignInManager.IsSignedIn(User) && User.IsInRole("Admin"))
                                {
                                    <a asp-action="ReplenishProduct" asp-controller="Products" asp-route-id="@groupOfProducts.First().ProductId" class=" col-6 btn btn-primary" style="width: auto">Replenish Product</a>
                                    <a asp-action="DeleteProduct" asp-controller="Products" asp-route-id="@groupOfProducts.First().ProductId" class="col-6 btn btn-danger" style="width: auto">Remove Product</a>
                                }
                                else
                                {
                                    <a asp-action="PurchaseOperation" asp-controller="Purchase" asp-route-id="@groupOfProducts.First().ProductId" class="col-6 btn btn-primary">Buy</a>
                                    <a asp-action="BookOperation" asp-controller="Book" asp-route-id="@groupOfProducts.First().ProductId" class="col-6 btn btn-success">Book</a>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <p>No products in this category yet</p>
        }
    </div>
</div>